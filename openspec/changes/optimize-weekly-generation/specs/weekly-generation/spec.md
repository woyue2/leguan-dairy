## MODIFIED Requirements
### Requirement: 周记生成入口
系统 SHALL 提供周记生成入口，允许用户选择日记生成周记。

#### Scenario: 进入周记生成页面
- **WHEN** 用户点击"周记"按钮
- **THEN** 显示周记选择界面
- **AND** 提供自然周选择器（本周、上周、自定义范围）

#### Scenario: 选择自然周范围
- **WHEN** 用户选择特定自然周
- **THEN** 自动显示该周范围内的所有日记
- **AND** 日记按日期分组显示（周一、周二...周日）
- **AND** 默认全选该范围内日记

### Requirement: 日记选择方式
系统 SHALL 支持两种日记选择方式：手动勾选和日期范围自动选择。

#### Scenario: 手动勾选日记
- **WHEN** 用户在列表中勾选/取消勾选日记
- **THEN** 更新已选择的日记数量
- **AND** 用户可以手动选择任意日记（不受日期限制）

#### Scenario: 日期范围选择
- **WHEN** 用户选择日期范围
- **THEN** 自动包含该范围内的所有日记
- **AND** 支持选择任意自然周（本周、上周、更早）
- **AND** 支持自定义起始和结束日期

### Requirement: 周记生成数量限制
系统 SHALL 不强制要求最少日记数量。

#### Scenario: 生成任意数量日记的周记
- **WHEN** 用户选择 1-3 篇日记并点击生成
- **THEN** 显示提示"选择了 X 篇日记，建议至少 3 篇以获得更好的生成效果"
- **AND** 用户确认后正常生成周记
- **AND** 不阻止用户生成少于 4 篇的周记

### Requirement: 周记内容预处理
系统 SHALL 对周记内容进行智能压缩和分批处理。

#### Scenario: 单篇日记压缩
- **WHEN** 单篇日记内容超过 500 字
- **THEN** 提取关键内容段，压缩至 500 字以内
- **AND** 保留日期、标题、核心事件描述
- **AND** 标记被压缩的内容为摘要

#### Scenario: 分批处理多篇日记
- **WHEN** 选择的日记超过 10 篇
- **THEN** 分批调用 AI API（每批最多 10 篇）
- **AND** 每批完成后合并结果
- **AND** 显示处理进度（X/Y 批）

### Requirement: 周记生成提示词
系统 SHALL 使用优化后的提示词进行周记生成。

#### Scenario: 结构分析和变化流动分析
- **WHEN** 调用 AI 生成周记
- **THEN** 提示词要求分析日记之间的变化流动
- **AND** 提示词要求识别情绪变化趋势
- **AND** 提示词要求发现事件发展脉络
- **AND** 提示词要求生成有故事感的周记

#### Scenario: 日期信息传递
- **WHEN** 传递日记内容给 AI
- **THEN** 每篇日记明确标注日期（格式：2024年1月15日 星期一）
- **AND** 按时间顺序组织内容
- **AND** 帮助 AI 理解事件发生的时间上下文

### Requirement: 周记结果展示
系统 SHALL 展示结构清晰、有故事感的周记。

#### Scenario: 展示周记结果
- **WHEN** AI 生成周记完成
- **THEN** 以分段文字形式展示
- **AND** 标题体现本周主题或变化
- **AND** 内容展现日子之间的变化流动
- **AND** 保持温暖治愈的基调
