# 变更：优化周记生成功能

## 为什么
当前周记生成存在以下问题：
1. 用户必须选择至少 4 篇日记，体验不灵活
2. 默认选择本周日记，但用户可能想生成上周的周记
3. 日期格式不够清晰，无法追溯具体日期的事件
4. AI 提示词仅关注内容整合，缺乏结构分析和变化流动分析
5. 多篇日记文本量可能过大，导致传输和接收问题

## 什么会改变
- 移除 4 篇日记的硬性限制，任意数量都可生成（保留提示）
- 支持按自然周选择（本周、上周、更早的自然周）
- 保持手动勾选方式，同时支持日期范围自动选择
- 在传递给 AI 的内容中明确标注日期
- 优化 AI 提示词：增加结构分析、事件变化流动分析
- 实施智能压缩 + 分批处理，解决文本过长问题

## 影响
- 受影响的规范：修改 `weekly-generation` 能力
- 受影响的代码：
  - `js/storage.js` - 日期范围查询方法优化
  - `js/ui.js` - 周记选择界面改版
  - `js/api.js` - 周记生成方法优化
  - `config/env.js` - 新的周记生成提示词
- 用户体验改进：更灵活的选择方式、更清晰的日期展示、更丰富的分析维度
