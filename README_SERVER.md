# ğŸ‰ é—®é¢˜å·²è§£å†³ï¼æ•°æ®ç°åœ¨ä¿å­˜åˆ°æœåŠ¡å™¨å®¹å™¨ä¸­

## â“ ä½ çš„é—®é¢˜

> ä¸ºä»€ä¹ˆä¸èƒ½æ”¾åˆ°å®¹å™¨é‡Œé¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

## âœ… ç°åœ¨çš„ç­”æ¡ˆ

**æ•°æ®ç°åœ¨å°±ä¿å­˜åœ¨ Docker å®¹å™¨ä¸­ï¼**

---

## ğŸ“Š ä¹‹å‰çš„æ–¹æ¡ˆ vs ç°åœ¨çš„æ–¹æ¡ˆ

### âŒ ä¹‹å‰ï¼ˆFile System APIï¼‰

```
ç”¨æˆ·ç”µè„‘ â†’ æµè§ˆå™¨ â†’ File System API â†’ ç”¨æˆ·æœ¬åœ°æ–‡ä»¶
                                                â†“
                                  C:\Users\...\diary.json

é—®é¢˜ï¼š
- æ¯ä¸ªç”¨æˆ·å„è‡ªä¿å­˜
- æ¢è®¾å¤‡ = æ•°æ®ä¸¢å¤±
- æ— æ³•é›†ä¸­ç®¡ç†
- ä¸é€‚åˆéƒ¨ç½²
```

### âœ… ç°åœ¨ï¼ˆæœåŠ¡å™¨å­˜å‚¨ï¼‰

```
ä»»ä½•è®¾å¤‡ â†’ æµè§ˆå™¨ â†’ API â†’ Docker å®¹å™¨ â†’ Docker Volume
                                    â†“
                          /data/diary/diary.json

ä¼˜åŠ¿ï¼š
- æ‰€æœ‰è®¾å¤‡å…±äº«æ•°æ®
- æ•°æ®é›†ä¸­ç®¡ç†
- Docker Volume æŒä¹…åŒ–
- å®Œç¾é€‚åˆéƒ¨ç½²
```

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¾å¤‡1 (ç”µè„‘)                                    â”‚
â”‚  http://172.245.142.4:3000                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·è®¾å¤‡2 (æ‰‹æœº)                                    â”‚
â”‚  http://172.245.142.4:3000                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker å®¹å™¨ (172.245.142.4:3000)                  â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Nginx (å‰ç«¯)                           â”‚       â”‚
â”‚  â”‚ - HTML, CSS, JS                       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                    â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Node.js Express (åç«¯API)              â”‚       â”‚
â”‚  â”‚ - GET/POST /api/diaries               â”‚       â”‚
â”‚  â”‚ - GET/POST /api/weeklies              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                    â†“                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Docker Volume: diary-data              â”‚       â”‚
â”‚  â”‚ - diary.json                          â”‚       â”‚
â”‚  â”‚ - weekly.json                         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ç«‹å³éƒ¨ç½²

### æ–¹å¼1: Docker Composeï¼ˆæœ€ç®€å•ï¼‰

```bash
cd /home/aa/Park/diary-app
docker-compose up -d
```

### æ–¹å¼2: Docker å‘½ä»¤

```bash
cd /home/aa/Park/diary-app

# æ„å»ºé•œåƒ
docker build -t diary-app:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name diary-app \
  -p 3000:3000 \
  -v diary-data:/data/diary \
  --restart unless-stopped \
  diary-app:latest
```

### æ–¹å¼3: éƒ¨ç½²åˆ°è¿œç¨‹æœåŠ¡å™¨

```bash
# æœ¬åœ°æ„å»º
cd /home/aa/Park/diary-app
docker build -t diary-app:latest .
docker save diary-app:latest > diary-app.tar

# ä¸Šä¼ 
scp diary-app.tar root@172.245.142.4:/root/

# æœåŠ¡å™¨ä¸Š
ssh root@172.245.142.4
docker load < diary-app.tar
docker run -d --name diary-app -p 3000:3000 \
  -v diary-data:/data/diary diary-app:latest
```

---

## ğŸ“ æ•°æ®ä½ç½®

### åœ¨æœåŠ¡å™¨ä¸Š

```bash
# Docker Volume ä½ç½®
/var/lib/docker/volumes/diary-data/_data/

# å®é™…æ–‡ä»¶
/var/lib/docker/volumes/diary-data/_data/diary.json
/var/lib/docker/volumes/diary-data/_data/weekly.json
```

### è®¿é—®æ•°æ®

```bash
# æ–¹å¼1: è¿›å…¥å®¹å™¨
docker exec -it diary-app sh
cat /data/diary/diary.json

# æ–¹å¼2: ç›´æ¥æŸ¥çœ‹ Volume
docker run --rm -v diary-data:/data alpine cat /data/diary/diary.json

# æ–¹å¼3: API è·å–
curl http://172.245.142.4:3000/api/diaries | jq
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡

```bash
docker ps | grep diary-app
```

### 2. å¥åº·æ£€æŸ¥

```bash
curl http://localhost:3000/api/health
```

**é¢„æœŸè¾“å‡º**:
```json
{
  "status": "ok",
  "dataDir": "/data/diary",
  "diariesCount": 0,
  "weekliesCount": 0
}
```

### 3. æµ‹è¯•åŠŸèƒ½

1. æ‰“å¼€æµè§ˆå™¨: http://172.245.142.4:3000
2. Header æ˜¾ç¤º: `æœåŠ¡å™¨å­˜å‚¨`
3. å†™ä¸€ç¯‡æ—¥è®°å¹¶ä¿å­˜
4. åˆ·æ–°é¡µé¢ - æ•°æ®åº”è¯¥è¿˜åœ¨
5. æ¢ä¸ªè®¾å¤‡è®¿é—® - æ•°æ®åŒæ­¥ï¼

---

## ğŸ’¾ å¤‡ä»½æ•°æ®

### æ‰‹åŠ¨å¤‡ä»½

```bash
# å¤‡ä»½æ•´ä¸ª Volume
docker run --rm \
  -v diary-data:/data \
  -v $(pwd):/backup \
  alpine \
  tar czf /backup/diary-backup-$(date +%Y%m%d).tar.gz -C /data .
```

### è‡ªåŠ¨å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /root/backup-diary.sh << 'EOF'
#!/bin/bash
docker run --rm \
  -v diary-data:/data \
  -v /root/backups:/backup \
  alpine \
  tar czf /backup/diary-$(date +%Y%m%d_%H%M%S).tar.gz -C /data .
EOF

chmod +x /root/backup-diary.sh

# æ·»åŠ åˆ°å®šæ—¶ä»»åŠ¡
crontab -e
# æ·»åŠ : 0 2 * * * /root/backup-diary.sh
```

---

## ğŸ”„ æ›´æ–°åº”ç”¨

```bash
# é‡æ–°æ„å»º
docker build -t diary-app:latest .

# é‡å¯å®¹å™¨ï¼ˆæ•°æ®ä¼šä¿ç•™ï¼‰
docker stop diary-app
docker rm diary-app
docker run -d --name diary-app -p 3000:3000 \
  -v diary-data:/data/diary diary-app:latest
```

---

## ğŸ¯ æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§ | File System API | æœåŠ¡å™¨å­˜å‚¨ |
|------|----------------|-----------|
| æ•°æ®ä½ç½® | ç”¨æˆ·æœ¬åœ° | Dockerå®¹å™¨ |
| å¤šè®¾å¤‡åŒæ­¥ | âŒ | âœ… |
| é›†ä¸­ç®¡ç† | âŒ | âœ… |
| å¤‡ä»½ | æ‰‹åŠ¨ | è‡ªåŠ¨ |
| éƒ¨ç½²å‹å¥½ | âŒ | âœ… |
| æ•°æ®å…±äº« | âŒ | âœ… |

---

## ğŸ“– å®Œæ•´æ–‡æ¡£

- **SERVER_STORAGE_GUIDE.md** - æœåŠ¡å™¨å­˜å‚¨å®Œæ•´æŒ‡å—
- **docker-compose.yml** - Docker Compose é…ç½®
- **server.js** - åç«¯ API å®ç°
- **storage-server.js** - æœåŠ¡å™¨å­˜å‚¨é€»è¾‘

---

## ğŸ‰ æ€»ç»“

**ç°åœ¨æ•°æ®å°±ä¿å­˜åœ¨å®¹å™¨é‡Œï¼**

- ğŸ“ ä½ç½®: `/var/lib/docker/volumes/diary-data/_data/`
- ğŸ”— API: `http://172.245.142.4:3000/api/*`
- ğŸ’¾ æŒä¹…åŒ–: Docker Volume
- ğŸ”„ åŒæ­¥: æ‰€æœ‰è®¾å¤‡è‡ªåŠ¨åŒæ­¥

**ä»ä»»ä½•è®¾å¤‡è®¿é—®éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„æ•°æ®ï¼**

å¼€å§‹éƒ¨ç½²å§ï¼ğŸš€
